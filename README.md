# API –°–µ—Ä–≤–∏—Å –ó–∞—è–≤–æ–∫ –Ω–∞ –ó–∞–π–º (Yii2, Nginx, PostgreSQL, Docker)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ—Å—Ç–æ–µ API –¥–ª—è –ø–æ–¥–∞—á–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –∑–∞–π–º, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ —Å—Ç–µ–∫–µ Yii2, Nginx, PostgreSQL –∏ Docker Compose.

## üöÄ –°—Ç–µ–∫ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **–ë—ç–∫–µ–Ω–¥:** PHP 8.2 / Yii2 Framework
* **–í–µ–±-—Å–µ—Ä–≤–µ—Ä:** Nginx
* **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 13
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker Compose

## üì¶ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ó–∞–ø—É—Å–∫—É

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
* Docker
* Docker Compose

---

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞


**–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    
    git clone https://github.com/contragents/loans.git
    (–∏–ª–∏ URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤–º–µ—Å—Ç–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ)
    
    
### 2. –ó–∞–ø—É—Å–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
docker-compose up -d --build
```
–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —Å–ª—É–∂–±—ã:

Nginx
- –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

PostgreSQL 
- host: localhost
- –ø–æ—Ä—Ç: 5432
- –Ω–∞–∑–≤–∞–Ω–∏–µ –ë–î: loans
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user
- –ø–∞—Ä–æ–ª—å: password

PHP 
- –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è (volume) –ø–∞–ø–∫–∞ app, –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è —Ñ–∞–π–ª .env –≤ –ø–∞–ø–∫—É /app –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è composer install –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–≤ —Ç–æ–º —á–∏—Å–ª–µ Yii2 –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—è yii migrate - —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ migrations –∏ —Ç–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ (request)

–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL, –∞ —Ç–∞–∫–∂–µ YII-ENV –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ .env, –∫–æ—Ç–æ—Ä–π –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–µ–∂–∏–º YII-ENV=prod,
–ø–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–∏–∏
"–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–æ–¥–∞: –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤–∞—à –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω..." 
- –ò—Å—Ö–æ–¥–∏–º –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã docker-compose up -d --build
- –í–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ .env –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ø—Ä–∞–≤–∏–ª–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É–∫–∞–∑–∞–Ω—ã –≤ –∑–∞–¥–∞–Ω–∏–∏ - —Ç.–µ. —è–≤–ª—è—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏

–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —Ç–æ –ø—Ä–∏–º–µ—Ä .env-—Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ .env.example.dev  

### 3. –î–æ—Å—Ç—É–ø –∫ API

1. –≠–Ω–¥–ø–æ–π–Ω—Ç POST http://localhost/requests
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ–∞–π–ª–∞ –æ—Ç–ª–∞–¥–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ POST.http –∏–∑ –ø–∞–ø–∫–∏ api-test

2. –≠–Ω–¥–ø–æ–π–Ω—Ç GET http://localhost/processor
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä ?delay=<–∫–æ–ª-–≤–æ —Å–µ–∫—É–Ω–¥>

3. –õ—é–±–æ–π –∏–Ω–æ–π URI –∏–ª–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ (GET, POST) –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Å—Ç–∞—Ç—É—Å—É 403 –∏ —Ç–µ–∫—Å—Ç—É {"result":"Forbidden"} –≤ –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–∏—Å–∞